# Weekend TODO (Oct 4–5)

## Backend – FastAPI scaffold

- [ ] Create `backend/` project with dependency management (`requirements.txt` or `pyproject.toml`)
- [ ] Add deps: `fastapi`, `uvicorn`, `pyjwt[crypto]`, `cachetools`, `httpx`, `supabase`
- [ ] Implement `backend/app/main.py` with FastAPI app and `/healthz`
- [ ] Add `.env` with `SUPABASE_URL`, `SUPABASE_ANON_KEY`

## Auth/JWT – BFF → FastAPI

- [ ] Frontend env: `BACKEND_BASE_URL=http://localhost:8000`
- [ ] Add Next.js BFF route `src/app/api/profile/route.ts` forwarding `Authorization: Bearer <token>`
- [ ] Verify Supabase SSR can read `access_token` and propagate refreshed cookies
- [ ] FastAPI: implement JWKS-based verification (strict `iss` and `aud`) with TTL cache
- [ ] FastAPI: add protected `/api/profile` using Supabase user impersonation (`postgrest.auth(token)`) and RLS

## Lecture uploads

- [ ] Design storage location (Supabase Storage bucket or local for dev)
- [ ] FastAPI endpoint: `POST /api/lectures/upload` (multipart) → store file → return id/url
- [ ] Validate file types and size; set CORS for BFF-only access if needed

## RAG pipeline (MVP)

- [ ] Extract text from uploaded file (start with PDFs)
- [ ] Chunk text (e.g., by paragraphs or tokens)
- [ ] Generate embeddings (choose service: OpenAI, local, etc.)
- [ ] Store vectors (choose store: Supabase pgvector or local)
- [ ] Query top-k and return snippets; simple rerank

## Environment & local dev

- [ ] Run FastAPI on :8000 (reload) and Next.js on :3000
- [ ] Configure CORS (restrict to Next.js server if exposing directly)
- [ ] Create `frontend/ui/.env.local` with Supabase vars

## Tests

- [ ] JWT flow: valid token → 200 on `/api/profile`
- [ ] Expired/invalid token → 401
- [ ] Wrong `iss`/`aud` → 401
- [ ] Basic RAG: embedding and retrieval returns non-empty results

## Stretch (time-permitting)

- [ ] Add `/api/healthz` in Next.js and FastAPI readiness checks
- [ ] Instrument logging for auth failures and JWKS cache stats
